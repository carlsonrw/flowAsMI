<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>

        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        </head>
    <body></body>


<script>

        // Define Stimuli
        var balance = jsPsych.randomization.sampleWithReplacement([1, 0], 1)
        var pM = jsPsych.randomization.sampleWithoutReplacement([2, 3, 4, 5, 6, 7, 8], 2)
        var pEM = jsPsych.randomization.sampleWithoutReplacement([6, 7, 8, 9, 10], 2)
        var GetDate = jsPsych.data.getURLVariable('date')
        var GetTime = jsPsych.data.getURLVariable('time')
        jsPsych.data.addProperties({
            Pr_M: pM,
            Pr_EM: pEM,
            Color_Order: balance,
            StartDate: GetDate,
            StartTime: GetTime,
        });

        if (pEM[0] == 6){
            pHit_M1   = "60%"
            pMiss_M1   = "40%"
        } else if (pEM[0] == 7){
            pHit_M1   = "70%"
            pMiss_M1   = "30%"
        } else if (pEM[0] == 8){
            pHit_M1   = "80%"
            pMiss_M1   = "20%"
        } else if (pEM[0] == 9){
            pHit_M1   = "90%"
            pMiss_M1   = "10%"
        } else if (pEM[0] == 10){
            pHit_M1   = "100%"
            pMiss_M1   = "0%"
        }

        if (pEM[1] == 6){
            pHit_M2   = "60%"
            pMiss_M2   = "40%"
        } else if (pEM[1] == 7){
            pHit_M2   = "70%"
            pMiss_M2   = "30%"
        } else if (pEM[1] == 8){
            pHit_M2   = "80%"
            pMiss_M2   = "20%"
        } else if (pEM[1] == 9){
            pHit_M2   = "90%"
            pMiss_M2   = "10%"
        } else if (pEM[1] == 10){
            pHit_M2   = "100%"
            pMiss_M2   = "0%"
        }

        if(balance == 1){
            R1Color      = "#35AA0F"
            R1ColorWord  = "<span class='a-span'>green</span>"
            R1Span       = "<span class='a-span'>Green Game</span>"
            R1BestOdds   = "<span class='a-span'>"+pHit_M1+"</span>"
            R1WorstOdds  = "<span class='a-span'>"+pMiss_M1+"</span>"
            R2Color      = "#339EFF"
            R2ColorWord  = "<span class='b-span'>blue</span>"
            R2Span       = "<span class='b-span'>Blue Game</span>"
            R2BestOdds   = "<span class='b-span'>"+pHit_M2+"</span>"
            R2WorstOdds  = "<span class='b-span'>"+pMiss_M2+"</span>"
        } else {
            R1Color      = "#339EFF"
            R1ColorWord  = "<span class='b-span'>blue</span>"
            R1Span       = "<span class='b-span'>Blue Game</span>"
            R1BestOdds   = "<span class='b-span'>"+pHit_M1+"</span>"
            R1WorstOdds  = "<span class='b-span'>"+pMiss_M1+"</span>"
            R2Color      = "#35AA0F"
            R2ColorWord  = "<span class='a-span'>green</span>"
            R2Span       = "<span class='a-span'>Green Game</span>"
            R2BestOdds   = "<span class='a-span'>"+pHit_M2+"</span>"
            R2WorstOdds  = "<span class='a-span'>"+pMiss_M2+"</span>"
        }

        if (pM[0] < pM[1]) {
            SpeedChng1   = "more"
            SpeedChng2   = "you won't have to respond as fast"
        } else if (pM[0] > pM[1]) {
            SpeedChng1  = "less"
            SpeedChng2  = "you'll have to respond faster"
        }

        var hit100_0 = jsPsych.randomization.shuffle([
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>"
            ])

        var hit90_10 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>"
            ])

        var hit80_20 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>"
            ])

        var hit70_30 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>"
            ])

        var hit60_40 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/jackpot.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            ])

        var miss100_0 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            ])

        var miss90_10 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            ])

        var miss80_20 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            ])

        var miss70_30 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            ])

        var miss60_40 = jsPsych.randomization.shuffle([
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/nope.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            "<img src='img/nope.png' class='rewardimg'>", "<img src='img/jackpot.png' class='rewardimg'>",
            ])

        var pM80 = jsPsych.randomization.shuffle([
            200, 200, 750, 750, 750, 750, 750, 750, 750, 750,
            ])

        var pM70 = jsPsych.randomization.shuffle([
            200, 200, 200, 750, 750, 750, 750, 750, 750, 750,
            ])

        var pM60 = jsPsych.randomization.shuffle([
            200, 252, 200, 200, 750, 750, 750, 750, 750, 750,
            ])

        var pM50 = jsPsych.randomization.shuffle([
            200, 200, 200, 200, 200, 750, 750, 750, 750, 750,
            ])

        var pM40 = jsPsych.randomization.shuffle([
            200, 200, 200, 200, 200, 200, 750, 750, 750, 750,
            ])

        var pM30 = jsPsych.randomization.shuffle([
            200, 200, 200, 200, 200, 200, 200, 750, 750, 750,
            ])

        var pM20 = jsPsych.randomization.shuffle([
            200, 200, 200, 200, 200, 200, 200, 200, 750, 750,
            ])

        var ITI = [250, 500, 750, 1000, 1250, 1500, 1750, 2000, 2250, 2500, 2750, 3000]

        var hits = -1

        var misses = -1

        var tNum = -1

//        var compchk1 = 0

        /* create timeline */
        var timeline = []

//      
//        //Function to check whether consent has been given
//        var check_consent = function(elem) {
//            if (document.getElementById('consent_checkbox').checked) {
//            return true;
//            }
//            else {
//                alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
//                return false;
//            }
//            return false;
//        };
//
//        //Presents external consent page to participants
//        var consent = {
//            type:'external-html',
//            url: "consent.html",
//            cont_btn: "start",
//            check_fn: check_consent
//        };
//        timeline.push(consent);

        /* define welcome message trial */
        var welcome = {
            type: "html-keyboard-response",
            stimulus: "<div class='parent'>"
        +"<p>Welcome!</p>"
        +"<p>In this survey, you will play games and answer questions about them.<br>"
        +"When you're ready to begin, press your SPACEBAR to proceed to the next screen.</p></div>"
        }

        var R1Intro_A = [
        "<div class='parent' style='text-align: left'>"
        +'<p>We are designing games that can be used by behavioral scientists to study motivation and decision making. To '
        +"make the games as engaging as possible, we are getting feedback from people like you.</p>"
        +"<p>You will play two different games: "
        +"the "+R1Span+" and the "+R2Span+". Then you will tell us "
        +"which you found more engaging.</p>"
        +"<p>The games are very similar, but their color schemes will help you tell them apart.</p>"
        +"<p>Continue to learn about and play the "+R1Span+".</p>"
        +"<p>After you finish, you will learn about and play the "+R2Span+".</p>"
        +"<p>Press your SPACEBAR to progress through each screen.</p></div>"]

        var R1Intro_B = [
        "<div class='parent'>"
        +'<p>The goal of the '+R1Span+' is to win as many "10-cent Jackpots" as possible.</p>'
        +'<p>For every 10-cent Jackpot you win, you will receive an extra 10 cents. '
        +'Thus, at the end of the study, you will receive a $5 eGiftcard for your participation, plus an additional 10 cents for each '
        +'10-cent Jackpot you win.</p></div>',
        "<div class='parent'>"
        +'<br>To win 10-cent Jackpots, you will try to "activate" tiles like this one:</p>'
        +'<div class="box" style="background-color:gray"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>The tiles will appear and disappear very quickly. "
        +"To activate a tile, you must press your SPACE BAR before it disappears. "
        +"Thus, whenever you see a tile, you should press your SPACE BAR as fast as possible.</p>"
        +'<div class="box" style="background-color:gray"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>In the "+R1Span+", tiles turn "+R1ColorWord+" if activated.</p>"
        +'<div class="box" style="background-color:'+R1Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>If you turn a tile "+R1ColorWord+", "
        +"your odds of winning a 10-cent Jackpot that trial are "+R1BestOdds+".</p>"
        +'<div class="box" style="background-color:'+R1Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +'<p>If a tile disappears before you turn it '+R1ColorWord+', '
        +"your odds of winning a 10-cent Jackpot that trial are "+R1WorstOdds+".</p>"
        +"</div>",
        "<div class='parent'>"
        +"<p>If you win a 10-cent Jackpot, you'll see this image...</p>"
        +"<img src='img/jackpot.png', style='height: 75%'>"
        +"</div>",
        "<div class='parent'>"
        +"<p>...and if you don't win a 10-cent Jackpot, you'll see this image.</p>"
        +"<img src='img/nope.png', style='height: 75%'>"
        +"</div>"]

        // LoMI to HiMI Instructions
        var R2Intro_A = [
        "<div class='parent'>"
        +"<p>Thank you for playing the "+R1Span+"!</p>"
        +"When you're ready, press your SPACEBAR to continue to the "+R2Span+".</p>"
        +"</div>"]

        var R2Intro_B = [
        "<div class='parent'>"
        +"<p>The "+R2Span+" is identical to the "+R1Span+" with three exceptions.</p>"
        +"</div>",
        "<div class='parent'>"
        +"<p>First, in the "+R2Span+", tiles turn "+R2ColorWord+" if activated.</p>"
        +'<div class="box" style="background-color:'+R2Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>Second, in the "+R2Span+", if you turn a tile "+R2ColorWord+", "
        +"<br>your odds of winning a 10-cent Jackpot that trial are "+R2BestOdds+" (instead of "+R1BestOdds+")...</p>"
        +'<div class="box" style="background-color:'+R2Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +'<p>...and if a tile disappears before you turn it '+R2ColorWord+', '
        +"<br>your odds of winning a 10-cent Jackpot that trial are "+R2WorstOdds+" (instead of "+R1WorstOdds+").</p>"
        +"</div>",
         "<div class='parent'>"
        +"<p>Finally, in the "+R2Span+", you'll have "+SpeedChng1+" time to activate the tiles."
        +"<br>Thus, in the "+R2Span+", "+SpeedChng2+".</p>"
        +'<div class="box" style="background-color:'+R2Color+'"></div>'
        +"</div>",
        "<div class='parent'>"
        +"<p>If you have read and understood the instructions, please continue to play the "+R2Span+"."
        +"<br>To re-read any of the instructions, press the 'previous' button to navigate back.</p>"
        +"</div>"]

        var scale_4 = [
            "0%", "10%", "20%", "30%", "40%", "50%",
            "60%", "70%", "80%", "90%", "100%",
        ];

        var R1_CompChk1 = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px">'
                +'<p>To make sure you understand the rules of the '+R1Span+', '
                +'please answer the following question.</p></div>',
            questions: [
                {prompt: 'If you turn a tile '+R1ColorWord+', what are your chances '
                +'of winning a 10-cent Jackpot on that trial?',
                name: 'R1_PrcntChk1',
                labels: scale_4},
            ],
            randomize_question_order: true,
            scale_width: 500,
            on_finish: function(data){
                compchk1 = data.responses;
            },
        };

        var R1_CompChk2 = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px">'
                +'<p>To make sure you understand the rules of the '+R1Span+', '
                +'please answer the following question.</p></div>',
            questions: [
                {prompt: 'If the tile disappears before you turn it '+R1ColorWord+', what are your chances '
                +'of winning a 10-cent Jackpot on that trial?',
                name: 'R1_PrcntChk2',
                labels: scale_4},
            ],
            randomize_question_order: true,
            scale_width: 500,
            on_finish: function(data){
                compchk2 = data.responses;
            },
        };

        var R2_CompChk1 = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px">'
                +'<p>To make sure you understand the rules of the '+R2Span+', '
                +'please answer the following question.</p></div>',
            questions: [
                {prompt: 'If you turn a tile '+R2ColorWord+', what are your chances '
                +'of winning a 10-cent Jackpot on that trial?',
                name: 'R2_PrcntChk1',
                labels: scale_4},
            ],
            randomize_question_order: true,
            scale_width: 500,
            on_finish: function(data){
                compchk3 = data.responses;
            },
        };

        var R2_CompChk2 = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px">'
                +'<p>To make sure you understand the rules of the '+R2Span+', '
                +'please answer the following question.</p></div>',
            questions: [
                {prompt: 'If the tile disappears before you turn it '+R2ColorWord+', what are your chances '
                +'of winning a 10-cent Jackpot on that trial?',
                name: 'R2_PrcntChk2',
                labels: scale_4},
            ],
            randomize_question_order: true,
            scale_width: 500,
            on_finish: function(data){
                compchk4 = data.responses;
            },
        };

        var T1a = {
            type: "instructions",
            pages: R1Intro_A,
            key_forward: 32,
        }

        var T1b = {
            type: "instructions",
            pages: R1Intro_B,
            key_forward: 32,
        }

        var ErrorMessage = {
            type: "instructions",
            pages: ["<div class='parent'>"
            +"<p>You provided the wrong answer.<br>To make sure you understand how to play, please continue to re-read the instructions.</p>"
            +"</div>"],
            key_forward: 32,
        }

        var R1_ConditionalNode = {
            timeline: [ErrorMessage],
            conditional_function: function(){
                pFM = 10 - pEM[0];
                if(compchk1[16] == pEM[0] && compchk2[16] == pFM ||
                    compchk1[17] == 0 && pEM[0] == 10 && compchk2[16] == pFM){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var R1_LoopNode = {
            timeline: [T1b, R1_CompChk1, R1_CompChk2, R1_ConditionalNode],
            loop_function: function(){
                pFM = 10 - pEM[0];
                if(compchk1[16] == pEM[0] && compchk2[16] == pFM ||
                    compchk1[17] == 0 && pEM[0] == 10 && compchk2[16] == pFM){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var T1c = {
            type: "instructions",
            pages: ["<div class='parent'>"
            +"<p>You are now ready to play the "+R1Span+".</p>"
            +"<p>Once you proceed, the "+R1Span+" will start immediately, "
            +"so get ready to press your SPACEBAR.</p>"
            +"<p>Continue to the next screen to begin.</p>"
            +"</div>"],
            key_forward: 32,
            post_trial_gap: 500,
        }

        var T2a = {
            type: "instructions",
            pages: R2Intro_A,
            key_forward: 32,
        }

        var T2b = {
            type: "instructions",
            pages: R2Intro_B,
            key_forward: 32,
        }

        var R2_ConditionalNode = {
            timeline: [ErrorMessage],
            conditional_function: function(){
                pFM = 10 - pEM[1];
                if(compchk3[16] == pEM[1] && compchk4[16] == pFM ||
                    compchk3[17] == 0 && pEM[1] == 10 && compchk4[16] == pFM){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var R2_LoopNode = {
            timeline: [T2b, R2_CompChk1, R2_CompChk2, R2_ConditionalNode],
            loop_function: function(){
                pFM = 10 - pEM[1];
                if(compchk3[16] == pEM[1] && compchk4[16] == pFM ||
                    compchk3[17] == 0 && pEM[1] == 10 && compchk4[16] == pFM){
                    return false;
                } else {
                    return true;
                }
            }
        }

        var T2c = {
            type: "instructions",
            pages: ["<div class='parent'>" 
            +"<p>You are now ready to play the "+R2Span+".</p>"
            +"<p>Once you proceed, the "+R2Span+" will start immediately, "
            +"so get ready to press your SPACEBAR.</p>"
            +"<p>Continue to the next screen to begin.</p>"
            +"</div>"],
            key_forward: 32,
            post_trial_gap: 500,
            on_finish: function(){
                hits = -1;
                misses = -1;
                tNum = -1;
            },
        }

        timeline.push(welcome)


        // Create Trials

        var Delay = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'ITI'},
            stimulus: "",
            choices: [32],
            trial_duration: function(){
                return jsPsych.randomization.sampleWithoutReplacement(ITI, 1)[0];
            },
            on_finish: function(data){
                if(data.key_press == 32){
                    data.TooFast = 1;
                    tNum = tNum + 1;
                } else {
                    data.TooFast = 0;
                    tNum = tNum + 1;
                }
            },
        }

        var TooFast = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Too_Fast_Message'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return "<div style='font-size: 20px'><p>Too Fast!</p>"+
                    "<p>Please wait for the tile to appear before pressing your SPACEBAR</p></div>"
                } else {
                    return ""
                }
            },
            trial_duration: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return 2500
                } else {
                    return 0
                }
            },
            post_trial_gap: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return 1000;
                } else {
                    return 0
                }
            },
            choices: jsPsych.NO_KEYS,
        }

        var R1_Probe = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Probe'},
            stimulus: '<div class="box" style="background-color:gray"></div>',
            choices: [32],
            trial_duration: function(){
                if(pM[0] == 8){
                    return pM80[tNum];
                } else if(pM[0] == 7){
                    return pM70[tNum];
                } else if(pM[0] == 6){
                    return pM60[tNum];
                } else if(pM[0] == 5){
                    return pM50[tNum];
                } else if(pM[0] == 4){
                    return pM40[tNum];
                } else if(pM[0] == 3){
                    return pM30[tNum];
                } else if(pM[0] == 2){
                    return pM20[tNum];
                }
            },
            on_finish: function(data){
                if(data.key_press == 32 && tNum < 9){
                    data.TooSlow = 0;
                } else if(data.key_press != 32 && tNum < 9){
                    data.TooSlow = 1;
                } else if(data.key_press == 32 && tNum == 9){
                    data.TooSlow = 0;
                    tNum = -1;
                    pM80 = jsPsych.randomization.shuffle(pM80);
                    pM70 = jsPsych.randomization.shuffle(pM70);
                    pM60 = jsPsych.randomization.shuffle(pM60);
                    pM50 = jsPsych.randomization.shuffle(pM50);
                    pM40 = jsPsych.randomization.shuffle(pM40);
                    pM30 = jsPsych.randomization.shuffle(pM30);
                    pM20 = jsPsych.randomization.shuffle(pM20);
                } else if(data.key_press != 32 && tNum == 9){
                    data.TooSlow = 1;
                    tNum = -1;
                    pM80 = jsPsych.randomization.shuffle(pM80);
                    pM70 = jsPsych.randomization.shuffle(pM70);
                    pM60 = jsPsych.randomization.shuffle(pM60);
                    pM50 = jsPsych.randomization.shuffle(pM50);
                    pM40 = jsPsych.randomization.shuffle(pM40);
                    pM30 = jsPsych.randomization.shuffle(pM30);
                    pM20 = jsPsych.randomization.shuffle(pM20);
                }
            },
        }

        var R2_Probe = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Probe'},
            stimulus: '<div class="box" style="background-color:gray"></div>',
            choices: [32],
            trial_duration: function(){
                if(pM[1] == 8){
                    return pM80[tNum];
                } else if(pM[1] == 7){
                    return pM70[tNum];
                } else if(pM[1] == 6){
                    return pM60[tNum];
                } else if(pM[1] == 5){
                    return pM50[tNum];
                } else if(pM[1] == 4){
                    return pM40[tNum];
                } else if(pM[1] == 3){
                    return pM30[tNum];
                } else if(pM[1] == 2){
                    return pM20[tNum];
                }
            },
            on_finish: function(data){
                if(data.key_press == 32 && tNum < 9){
                    data.TooSlow = 0;
                } else if(data.key_press != 32 && tNum < 9){
                    data.TooSlow = 1;
                } else if (data.key_press == 32 && tNum == 9){
                    data.TooSlow = 0;
                    tNum = -1;
                    pM80 = jsPsych.randomization.shuffle(pM80);
                    pM70 = jsPsych.randomization.shuffle(pM70);
                    pM60 = jsPsych.randomization.shuffle(pM60);
                    pM50 = jsPsych.randomization.shuffle(pM50);
                    pM40 = jsPsych.randomization.shuffle(pM40);
                    pM30 = jsPsych.randomization.shuffle(pM30);
                    pM20 = jsPsych.randomization.shuffle(pM20);
                } else if (data.key_press != 32 && tNum == 9){
                    data.TooSlow = 1;
                    tNum = -1;
                    pM80 = jsPsych.randomization.shuffle(pM80);
                    pM70 = jsPsych.randomization.shuffle(pM70);
                    pM60 = jsPsych.randomization.shuffle(pM60);
                    pM50 = jsPsych.randomization.shuffle(pM50);
                    pM40 = jsPsych.randomization.shuffle(pM40);
                    pM30 = jsPsych.randomization.shuffle(pM30);
                    pM20 = jsPsych.randomization.shuffle(pM20);
                }
            },
        }

        var Response_R1 = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Activation_R1'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return '<div class="box" style="background-color:'+R1Color+'"> </div>'
                } else {
                    return '<div class="box" style="background-color:white"> </div>'
                }
            },
            choices: [32],
            response_ends_trial: false,
            trial_duration: 1000,
            on_finish: function(){
                if (jsPsych.data.get().last(2).values()[0].key_press != 32 && misses < 9){
                    misses = misses + 1;
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && hits < 9){
                    hits = hits + 1;
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32){
                    hits = 0;
                    hit100_0 = jsPsych.randomization.shuffle(hit100_0);
                    hit90_10 = jsPsych.randomization.shuffle(hit90_10);
                    hit80_20 = jsPsych.randomization.shuffle(hit80_20);
                    hit70_30 = jsPsych.randomization.shuffle(hit70_30);
                    hit60_40 = jsPsych.randomization.shuffle(hit60_40);
                } else {
                    misses = 0;
                    miss100_0 = jsPsych.randomization.shuffle(miss100_0);
                    miss90_10 = jsPsych.randomization.shuffle(miss90_10);
                    miss80_20 = jsPsych.randomization.shuffle(miss80_20);
                    miss70_30 = jsPsych.randomization.shuffle(miss70_30);
                    miss60_40 = jsPsych.randomization.shuffle(miss60_40);
                }
            },
        }

        var Response_R2 = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Activation_R2'},
            stimulus: function(){
                if(jsPsych.data.get().last(1).values()[0].key_press == 32){
                    return '<div class="box" style="background-color:'+R2Color+'"> </div>'
                } else {
                    return '<div class="box" style="background-color:white"> </div>'
                }
            },
            choices: [32],
            response_ends_trial: false,
            trial_duration: 1000,
            on_finish: function(){
                if (jsPsych.data.get().last(2).values()[0].key_press != 32 && misses < 9){
                    misses = misses + 1;
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && hits < 9){
                    hits = hits + 1;
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32){
                    hits = 0;
                    hit100_0 = jsPsych.randomization.shuffle(hit100_0);
                    hit90_10 = jsPsych.randomization.shuffle(hit90_10);
                    hit80_20 = jsPsych.randomization.shuffle(hit80_20);
                    hit70_30 = jsPsych.randomization.shuffle(hit70_30);
                    hit60_40 = jsPsych.randomization.shuffle(hit60_40);
                } else {
                    misses = 0;
                    miss100_0 = jsPsych.randomization.shuffle(miss100_0);
                    miss90_10 = jsPsych.randomization.shuffle(miss90_10);
                    miss80_20 = jsPsych.randomization.shuffle(miss80_20);
                    miss70_30 = jsPsych.randomization.shuffle(miss70_30);
                    miss60_40 = jsPsych.randomization.shuffle(miss60_40);
                }
            },
        }

        var Feedback_R1 = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Feedback_R1'},
            stimulus: function(){
                if(jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[0] == 10){
                    return hit100_0[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[0] == 10){
                    return miss100_0[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[0] == 9){
                    return hit90_10[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[0] == 9){
                    return miss90_10[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[0] == 8){
                    return hit80_20[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[0] == 8){
                    return miss80_20[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[0] == 7){
                    return hit70_30[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[0] == 7){
                    return miss70_30[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[0] == 6){
                    return hit60_40[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[0] == 6){
                    return miss60_40[misses];
                }
            },
            on_finish: function(data){
                if(data.stimulus == "<img src='img/jackpot.png' class='rewardimg'>"){
                    data.Jackpot = true;
                } else if (data.stimulus == "<img src='img/nope.png' class='rewardimg'>"){
                    data.Jackpot = false;
                }
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 1500,
        }

        var Feedback_R2 = {
            type: 'html-keyboard-response',
            data: {Trial_Type: 'Feedback_R2'},
            stimulus: function(){
                if(jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[1] == 10){
                    return hit100_0[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[1] == 10){
                    return miss100_0[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[1] == 9){
                    return hit90_10[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[1] == 9){
                    return miss90_10[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[1] == 8){
                    return hit80_20[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[1] == 8){
                    return miss80_20[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[1] == 7){
                    return hit70_30[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[1] == 7){
                    return miss70_30[misses];
                } else if (jsPsych.data.get().last(2).values()[0].key_press == 32 && pEM[1] == 6){
                    return hit60_40[hits];
                } else if (jsPsych.data.get().last(2).values()[0].key_press != 32 && pEM[1] == 6){
                    return miss60_40[misses];
                }
            },
            on_finish: function(data){
                if(data.stimulus == "<img src='img/jackpot.png' class='rewardimg'>"){
                    data.Jackpot = true;
                } else if (data.stimulus == "<img src='img/nope.png' class='rewardimg'>"){
                    data.Jackpot = false;
                }
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 1500,
        }

        var R1_Procedure = {
            timeline: [Delay, TooFast, R1_Probe, Response_R1, Feedback_R1],
            repetitions: 50,
        }

        var R2_Procedure = {
            timeline: [Delay, TooFast, R2_Probe, Response_R2, Feedback_R2],
            repetitions: 50,
        }

        var scale_1 = [
            "0<br>Not<br>at all",
            "1", "2", "3", "4", "5", "6", "7",
            "8<br>Extremely",
        ];

        var scale_2 = [
            '0<br><div style="font-size:12px">Zero<br>Control</div>',
            "1", "2", "3", "4", "5", "6", "7",
            '8<br><div style="font-size:12px">Complete<br>Control</div>',
        ];

        var scale_3 = [
            '-4<br><div style="font-size:12px">Way<br>Too<br>Easy</div>',
            "-3",
            "-2",
            "-1",
            '0<br><div style="font-size:12px">Just<br>Right</div>',
            "1",
            "2",
            "3",
            '4<br><div style="font-size:12px">Way<br>Too<br>Hard</div>',
        ];



        var scale_5 = [
            "0<br>Not<br>at all",
            "1", "2", "3", "4", "5", "6", "7",
            "8<br>A lot",
        ];

        var scale_6 = [
            "Activating<br>Tiles",
            "", "", "", "", "",
            "Winning<br>Jackpots",
        ];

        var scale_7 = [
            "Pressing My<br>SPACEBAR",
            "", "", "", "", "",
            "Earning<br>Money",
        ];

        var scale_NFC = [
            '1<br><div style="font-size:12px">Extremely Uncharacteristic of Me</div>',
            "2", "3", "4",
            '5<br><div style="font-size:12px">Extremely Characteristic of Me</div>',
        ];

        var R1_Attention = {
            type: 'survey-likert',
            preamble: 
                '<div style="padding-top: 50px; width: 850px; font-size:16px">'
                +'<p>Thank you for playing the '+R1Span+'!</p>'
                +'<p>Now, please provide your honest assessment of the '+R1Span
                +' by answering each of the following questions.</div>',
            questions: [
                {prompt: 'How engaging was the '+R1Span+'?',
                name: 'R1_Engaging',
                labels: scale_1},
                {prompt: 'How engrossing was the '+R1Span+'?',
                name: 'R1_Engrossing',
                labels: scale_1},
                {prompt: 'How immersive was the '+R1Span+'?',
                name: 'R1_Immersive',
                labels: scale_1},
                {prompt: 'How addictive was the '+R1Span+'?',
                name: 'R1_Addictive',
                labels: scale_1},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var R1_Time = {
            type: 'html-slider-response',
            stimulus: 
                '<p>How long did it feel like the '+R1Span+' lasted?</p>'
                +'<p>Use the slider to indicate how long the '+R1Span+' seemed to last (in minutes).</p>',
            labels: ['0<br>min.', '1<br>min.', '2<br>min.', '3<br>min.', '4<br>min.', 
            '5<br>min.', '6<br>min.', '7<br>min.', '8<br>min.'],
            min: 0,
            max: 48,
            start: 0,
            step: 1,
            slider_width: 500,
            require_movement: true,
        };

        var R1_Valence = {
            type: 'survey-likert',
            preamble: 
                '<div style="padding-top: 50px; width: 850px; font-size:16px"><p></p></div>',
            questions: [
                {prompt: 'How much did you like the '+R1Span+'?',
                name: 'R1_Like',
                labels: scale_5},
                {prompt: 'How much did you dislike the '+R1Span+'?',
                name: 'R1_Dislike',
                labels: scale_5},
                {prompt: 'How enjoyable was the '+R1Span+'?',
                name: 'R1_Enjoyable',
                labels: scale_1},
                {prompt: 'How fun was the '+R1Span+'?',
                name: 'R1_Fun',
                labels: scale_1},
                {prompt: 'How entertaining was the '+R1Span+'?',
                name: 'R1_Entertaining',
                labels: scale_1},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var R1_CtrlBal = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px"><p></p></div>',
            questions: [
                {prompt: 'While playing the '+R1Span+', how much control did you feel you had over the outcome of each trial?',
                name: 'R1_Control',
                labels: scale_2},
                {prompt: 'Was the '+R1Span+' too easy, too hard, or just the right level of difficulty?',
                name: 'R1_Balance',
                labels: scale_3},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var R1_Construal = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px"><p>Any activity can be described in many ways. We are interested in how you would describe the activity of playing the '+R1Span+'. Below, you will see pairs of descriptions. For each pair, please report the degree to which one description better describes the activity of playing the '+R1Span+'.</p></div>',
            questions: [
                {prompt: 'Which of the following better describes the activity of playing the '+R1Span+'.',
                name: 'R1_Construal1',
                labels: scale_6},
                {prompt: 'Which of the following better describes the activity of playing the '+R1Span+'.',
                name: 'R1_Construal2',
                labels: scale_7},
            ],
            randomize_question_order: false,
            scale_width: 500
        };



        var R2_Attention = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 850px; font-size:16px">'
                +'<p>Thank you for playing the '+R2Span+'!</p>'
                +'<p>Now, please provide your honest assessment of the '+R2Span+' by answering each of the following questions.</div>',
            questions: [
                {prompt: 'How engaging was the '+R2Span+'?',
                name: 'R2_Engaging',
                labels: scale_1},
                {prompt: 'How engrossing was the '+R2Span+'?',
                name: 'R2_Engrossing',
                labels: scale_1},
                {prompt: 'How immersive was the '+R2Span+'?',
                name: 'R2_Immersive',
                labels: scale_1},
                {prompt: 'How addictive was the '+R2Span+'?',
                name: 'R2_Addictive',
                labels: scale_1},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var R2_Time = {
            type: 'html-slider-response',
            stimulus: 
                '<div style="padding-top: 50px; width: 700px; font-size:16px">'
                +'<p>How long did it feel like the '+R2Span+' lasted?</p>'
                +'<p>Use the slider to indicate how long the '+R2Span+' seemed to last (in minutes).</div>',
            labels: ['0<br>min.', '1<br>min.', '2<br>min.', '3<br>min.', '4<br>min.', 
            '5<br>min.', '6<br>min.', '7<br>min.', '8<br>min.'],
            min: 0,
            max: 48,
            start: 0,
            step: 1,
            slider_width: 500,
            require_movement: true,
        };

        var R2_Valence = {
            type: 'survey-likert',
            preamble: 
                '<div style="padding-top: 50px; width: 850px; font-size:16px"><p></p></div>',
            questions: [
                {prompt: 'How much did you like the '+R2Span+'?',
                name: 'R2_Like',
                labels: scale_5},
                {prompt: 'How much did you dislike the '+R2Span+'?',
                name: 'R2_Dislike',
                labels: scale_5},
                {prompt: 'How enjoyable was the '+R2Span+'?',
                name: 'R2_Enjoyable',
                labels: scale_1},
                {prompt: 'How fun was the '+R2Span+'?',
                name: 'R2_Fun',
                labels: scale_1},
                {prompt: 'How entertaining was the '+R2Span+'?',
                name: 'R2_Entertaining',
                labels: scale_1},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var R2_CtrlBal = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px"><p></p></div>',
            questions: [
                {prompt: 'While playing the '+R2Span+', how much control did you feel you had over the outcome of each trial?',
                name: 'R2_Control',
                labels: scale_2},
                {prompt: 'Was the '+R2Span+' too easy, too hard, or just the right level of difficulty?',
                name: 'R2_Balance',
                labels: scale_3},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var R2_Construal = {
            type: 'survey-likert',
            preamble:
                '<div style="padding-top: 50px; width: 800px; font-size:16px"><p>Any activity can be described in many ways. We are interested in how you would describe the activity of playing the '+R2Span+'. Below, you will see pairs of descriptions. For each pair, please report the degree to which one description better describes the activity of playing the '+R2Span+'.</p></div>',
            questions: [
                {prompt: 'Which of the following better describes the activity of playing the '+R2Span+'.',
                name: 'R2_Construal1',
                labels: scale_6},
                {prompt: 'Which of the following better describes the activity of playing the '+R2Span+'.',
                name: 'R2_Construal2',
                labels: scale_7},
            ],
            randomize_question_order: false,
            scale_width: 500
        };

        var E_ChooseGame = {
            type: 'html-button-response',
            stimulus: '<p>If you had to play one game a second time, which would you choose?</p>',
            choices: [''+R1Span+'', ''+R2Span+''],
        };

        var E_NFC = {
            type: 'survey-likert',
            preamble: 
                '<div style="padding-top: 50px; width: 850px; font-size:16px">'
                +'<p>Please indicate how well each of the following statements describes your personality.</p>' 
                +'<p>Specifically, use the scales to indiciate the degree to which each statement is characteristic of you.</p></div>',
            questions: [
                {prompt: '"I like complex problems more than simple problems."',
                name: 'E_NFC1',
                labels: scale_NFC},
                {prompt: '"I like to have the responsibility of handling a situation that requires a lot of thinking."',
                name: 'E_NFC2',
                labels: scale_NFC},
                {prompt: '"Thinking is not my idea of fun."',
                name: 'E_NFC3reverse',
                labels: scale_NFC},
                {prompt: '"I would rather do something that requires little thought<br>than something that is sure to challenge my thinking abilities."',
                name: 'E_NFC4reverse',
                labels: scale_NFC},
                {prompt: '"I try to anticipate and avoid situations where there is a likely chance<br>I will have to think in depth about something."',
                name: 'E_NFC5reverse',
                labels: scale_NFC},
                {prompt: '"I find satisfaction in deliberating hard and for long hours."',
                name: 'E_NFC6',
                labels: scale_NFC},
                {prompt: '"I only think as hard as I have to."',
                name: 'E_NFC7reverse',
                labels: scale_NFC},
                {prompt: '"I prefer to think about small, daily projects to long-term ones."',
                name: 'E_NFC8reverse',
                labels: scale_NFC},
                {prompt: '"I like tasks that require little thought once'+" I've "+'learned them."',
                name: 'E_NFC9reverse',
                labels: scale_NFC},
                {prompt: '"The idea of relying on thought to make my way to the top appeals to me."',
                name: 'E_NFC10',
                labels: scale_NFC},
                {prompt: '"I really enjoy a task that involves coming up with new solutions to problems."',
                name: 'E_NFC11',
                labels: scale_NFC},
                {prompt: '"Learning new ways to think'+" doesn't "+'excite me very much."',
                name: 'E_NFC12reverse',
                labels: scale_NFC},
                {prompt: '"I prefer my life to be filled with puzzles that I must solve."',
                name: 'E_NFC13',
                labels: scale_NFC},
                {prompt: '"The notion of thinking abstractly is appealing to me."',
                name: 'E_NFC14',
                labels: scale_NFC},
                {prompt: '"I would prefer a task that is intellectual, difficult, and important</br>to one that is somewhat important but does not require much thought."',
                name: 'E_NFC15',
                labels: scale_NFC},
                {prompt: '"I feel relief rather than satisfaction after completing<br>a task that required a lot of mental effort."',
                name: 'E_NFC16reverse',
                labels: scale_NFC},
                {prompt: '"'+"It's "+'enough for me that something gets the job done; I '+"don't "+'care how or why it works."',
                name: 'E_NFC17reverse',
                labels: scale_NFC},
                {prompt: '"I usually end up deliberating about issues even when they do not affect me personally."',
                name: 'E_NFC18',
                labels: scale_NFC},
            ],
            scale_width: 400
        };

        var test_procedure = {
            timeline: [
            T1a, R1_LoopNode, T1c, R1_Procedure, R1_Attention, R1_Time, R1_Valence, R1_CtrlBal, R1_Construal,
            T2a, R2_LoopNode, T2c, R2_Procedure, R2_Attention, R2_Time, R2_Valence, R2_CtrlBal, R2_Construal,
            E_ChooseGame, E_NFC],
        }

        timeline.push(test_procedure)
    
    
    
////////////////// Ryan's edits for in-lab study //////////////////
    
    var E_gender = {
        type: 'html-button-response',
        stimulus: '<p>Gender:</p>',
        choices: ['Male', 'Female','Other'],
    };
    timeline.push(E_gender);  
      
      
    var E_age = {
          type: 'survey-text',
          questions: [
            {prompt: "Age:",
            name: "E_age"},
          ],
        }; 
    timeline.push(E_age);
    
    var E_ethnicity = {
        type: 'html-button-response',
        stimulus: '<p>Ethnicity:</p>',
        choices: ['White / Caucasian', 'Black / African American','Asian / Pacific Islander', 'Hispanic', 'Native American', 'Other'],
    };
    timeline.push(E_ethnicity);  
    
    var E_english = {
        type: 'html-button-response',
        stimulus: '<p>Is English your native language?:</p>',
        choices: ['Yes', 'No'],
    };
    timeline.push(E_english);  
    
    
    var E_finalword = {
          type: 'survey-text',
          questions: [
            {prompt: "Questions? Comments? Complains? Provide your feedback here!",
            rows: 10,
            columns: 100,
            name: "E_finalword"},
          ],
        }; 
    timeline.push(E_finalword);
        
    var E_email = {
        type: 'survey-text',
        questions: [
            {prompt: "",
            placeholder: "Email Address", 
            name: "E_email", 
            columns: 50,
            required: true}
        ],
        preamble: function(){
            var R1_JackPotTrials = jsPsych.data.get().filter({Trial_Type: 'Feedback_R1', Jackpot: true});
            var R2_JackPotTrials = jsPsych.data.get().filter({Trial_Type: 'Feedback_R2', Jackpot: true});
            var R1_TotalJackpots = R1_JackPotTrials.count();
            var R2_TotalJackpots = R2_JackPotTrials.count();
            var totaljackpots = R1_TotalJackpots + R2_TotalJackpots;         
            var totalbonus = totaljackpots/10;
            var totaldollars = (Math.round(totalbonus * 100) / 100).toFixed(2)         

            return '<p>Thank you for participating!</p><p>In total, you got <b>'+totaljackpots+' Jackpots</b>, which is worth <b>$'+totaldollars+'</b> in bonus money!<br>Within one week, you will receive your bonus money, plus $5 for your participation.</p><p>To receive payment, enter your email address in the space below. If you with to forgo payment, type NA. <b>After you submit, you will see a blank screen, which indicates that your submission was successful</b>.</p>'
        },
        button_label: ['CLICK HERE TO FINISH']
    };
    timeline.push(E_email);
    
    
    
  // WRITE TO DATABASE
        jsPsych.init({
            timeline: timeline, 
            on_finish: function() {
                firebase.database().ref(firebase.auth().currentUser.uid).set({
                    data: jsPsych.data.get().values()
                })
            }
        });
    
    
                
/////////////////////////////////////////////////
        
        
        
    
    
    

    
    </script>

<!--
    <script>
        db.collection("tasks").doc('new_task').collection('subjects').doc(uid).update({
            date: new push().toLocaleDateString(),
            time: new Date().toLocaleTimeString()
        });
    </script>
-->

</html>
